# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要

東京ランチマップ - React Router v7 + Turso Cloud + Vercelを使用したSSR対応のランチスポット検索Webアプリケーション。

## 開発コマンド

- **開発サーバー起動**: `npm run dev` (http://localhost:5173)
- **プロダクションビルド**: `npm run build`
- **型チェック**: `npm run typecheck`
- **プロダクションサーバー**: `npm start`

## 技術スタック

- **フロントエンド**: React Router v7 with SSR
- **スタイリング**: Tailwind CSS
- **地図**: Leaflet + OpenStreetMap
- **データベース**: Turso Cloud (SQLite) + @libsql/client
- **デプロイ**: Vercel + @vercel/react-router
- **型定義**: TypeScript

## プロジェクト構造

```
app/
├── components/          # 再利用可能なコンポーネント
│   └── Map.tsx         # Leaflet地図コンポーネント
├── lib/
│   └── db.server.ts    # データベース設定とクエリ関数
├── routes/             # ページルート
│   ├── home.tsx        # ホームページ
│   ├── map.tsx         # 地図ページ（メイン機能）
│   ├── restaurant.tsx  # 店舗詳細ページ
│   └── coming-soon.tsx # Coming Soonページ
├── routes.ts           # ルート設定
└── root.tsx           # アプリケーションルート
```

## データベーススキーマ

### restaurants テーブル
- 基本情報: name, address, latitude, longitude
- カテゴリ: cuisine_type, price_range
- 営業情報: opening_hours, is_open, crowdedness_level
- 追加情報: phone, website, photo_url, description, capacity

## 環境変数

`.env`ファイルに以下を設定:
```
TURSO_DATABASE_URL=libsql://your-database.turso.io
TURSO_AUTH_TOKEN=your-auth-token
```

## 主要機能

1. **地図表示**: Leaflet + OpenStreetMapによる東京都の地図表示
2. **店舗マーカー**: 料理ジャンル別のアイコンと混雑状況による色分け
3. **検索・絞り込み**: 料理ジャンル、価格帯、営業状況、混雑状況での絞り込み
4. **店舗詳細**: 店舗情報、アクセス、営業時間等の詳細表示
5. **レスポンシブ**: モバイル・デスクトップ対応
6. **SSR**: SEO対応とパフォーマンス最適化

## 開発時の注意点

- Leafletコンポーネントはクライアントサイドでのみ動作するため、useEffectで初期化
- 地図マーカーのカスタムアイコンはdivIconを使用
- データベース初期化とサンプルデータ挿入は初回ローダー実行時に自動実行
- Turso Cloudのローカル開発では`file:local.db`が使用される

## 主要機能

### 1. 地図表示機能
- **初回リリース**：東京都全域をカバー
- **将来展開**：その他地域は「Coming Soon」表示
- ユーザーが地図を操作可能（拡大・縮小・移動）
- 店舗位置をマーカーで表示
- マーカータップで店舗詳細表示

### 2. 店舗検索・絞り込み機能
#### 検索条件：
- **現在地からの距離**
- **料理ジャンル**：和食、洋食、中華、イタリアン、フレンチ、カフェ等
- **価格帯**：
  - ～1,000円
  - 1,000～2,000円
  - 2,000円～
- **営業時間**：現在営業中の店舗フィルター
- **利用人数**：
  - 1人
  - 2-4人
  - 5人以上
- **混み具合**：
  - 空いている
  - やや混雑
  - 混雑

### 3. 店舗情報表示
#### 表示項目：
- **基本情報**：
  - 店舗名
  - 住所
  - 詳細な営業時間
  - 電話番号
- **サービス情報**：
  - 料理ジャンル
  - 価格帯
  - 収容人数目安
- **視覚情報**：
  - 店舗外観・内装・料理写真
- **リアルタイム情報**：
  - 現在の営業状況
  - 混雑状況（推定）

### 4. 混雑状況表示機能
#### 実装方針：
- **Phase 1（初期実装）**：営業時間ベースの推定表示
  - 一般的なランチタイム（11:30-13:30）を「混雑」
  - 営業開始直後・終了前を「空いている」
  - その他を「やや混雑」として表示
- **Phase 2（将来実装）**：
  - Google Places APIの人気時間帯データ（1時間刻み）
  - ユーザーからのリアルタイム混雑報告機能

## データ取得戦略

### 店舗データソース
1. **Google Places API**（無料枠：月28,000リクエスト）
2. **OpenStreetMap + Overpass API**（完全無料）
3. **ぐるなびAPI**（無料プランあり）
4. **手動登録**（管理画面での補完）

### 対象範囲
- **初回リリース**：東京都内のランチ営業店舗を網羅
- **東京以外の地域**：「Coming Soon」表示でユーザーに今後の展開を予告
- レストラン、カフェ、定食屋、ファストフード等

## 非機能要件

### デザイン
- シンプルで使いやすいUI/UX
- スマートフォン対応（レスポンシブデザイン）
- 直感的な操作性

### パフォーマンス
- **SSR（Server-Side Rendering）**による高速な初期表示
- 地図の快適な操作性
- 検索結果の高速表示
- 画像の最適化読み込み
- SEO最適化（SSRによる検索エンジン対応）

### ユーザー機能
- **ユーザー登録・ログイン機能は不要**
- セッションベースの一時的な設定保存のみ

## 将来的な拡張機能

### Phase 2 実装予定
1. **口コミ機能**
   - ユーザーレビュー投稿
   - 評価システム（5段階評価）
2. **画像投稿機能**
   - 料理・店舗写真のユーザー投稿
   - 画像ギャラリー表示
3. **リアルタイム混雑報告**
   - ユーザーからの混雑状況報告
   - 15分刻みの精密な混雑データ蓄積

### Phase 3 検討事項
- **全国展開**：大阪、名古屋、福岡等の主要都市への対応
- 予約機能との連携
- お気に入り店舗機能
- ルート案内機能
- 多言語対応

## 開発優先順位

### 高優先度（MVP）
1. SSR対応の基盤構築（React Router v7）
2. 地図表示と基本的な店舗マーカー表示
3. 店舗データ取得・表示機能（SSR対応）
4. 基本的な検索・絞り込み機能
5. 店舗詳細表示（SEO対応）

### 中優先度
1. 詳細な絞り込み条件
2. 混雑状況推定表示
3. レスポンシブデザイン対応
4. パフォーマンス最適化

### 低優先度
1. 高度な検索機能
2. データ自動更新機能
3. 管理画面機能

### 技術的考慮事項

### SSR実装要件
- React Router v7のSSR機能を活用
- 店舗データのサーバーサイド事前取得
- SEO対応のためのメタタグ動的生成
- 初期表示速度の最適化

### API制限対策
- 複数データソースの併用
- サーバーサイドキャッシュ機能の実装
- 段階的データ取得

### 法的コンプライアンス
- 各APIの利用規約遵守
- データ利用許可の確認
- プライバシーポリシーの整備

### スケーラビリティ
- データベース設計の最適化
- 効率的なクエリ実装
- 将来的な機能拡張を考慮した設計
- SSRによるサーバー負荷の適切な管理

## 成功指標
- 東京都内の主要ランチスポットの80%以上カバー
- 検索結果表示速度3秒以内
- モバイル対応による快適な操作性
- ユーザーフィードバックによる継続的改善
- Coming Soon表示による将来的な全国展開への期待値向上